---
layout: page
title: 検索
permalink: /search/
---

<p markdown class="small-caution">注意: β版です。このブログに存在する単語でも、検索に引っかかったり引っかからなかったりします。本当に何かを探したい場合は、Googleで`site:skoji.jp 検索キーワード`などでお願いします</p>

<form action="get" id="site_search">
  <label for="search_box">検索 </label><input type="text" id="search_box">
  <input type="submit" value="search">
</form>

<ul id="search_results">
</ul>

<script src="../assets/js/lunr.min.js"></script>
<script src="../assets/js/lunr.stemmer.support.min.js"></script>
<script src="../assets/js/tinyseg.js"></script>
<script src="../assets/js/lunr.ja.min.js"></script>
<script>
 let postList;
 let idx;
 fetch('/blog/posts_lists_for_search.json').then((response) => {
     return response.json();
 }).then((json) => {
     postList = json;
 });

 fetch('/blog/search_data_indexed.json').then((response) => {
     return response.json();
 }).then((json) => {
     idx = lunr.Index.load(json);
 });
 
 const showResults = (results) => {
     const resultsList = document.querySelector('#search_results');
     resultsList.innerHTML = "";
     results.forEach((r) => {
         const item = postList[r.ref];
         const date = document.createTextNode(item.date);
         const a = document.createElement('a');
         a.href = item.url;
         a.innerText = item.title;
         const datespan = document.createElement('span');
         datespan.className = 'date';
         datespan.appendChild(date);
         
         const head = document.createElement('div');
         head.appendChild(datespan);
         head.appendChild(a);
         head.className = 'search-head';         
         
         const excerpt = document.createTextNode(item.excerpt);
         const excerptDiv = document.createElement('div');
         excerptDiv.appendChild(excerpt);
         excerptDiv.className = 'search-excerpt';         
         const li = document.createElement('li');
         
         li.appendChild(head);
         li.appendChild(excerptDiv);
         resultsList.appendChild(li);
     });
 }
 document.querySelector('#site_search').addEventListener('submit', (e) => {
     e.preventDefault();
     const q = document.querySelector('#search_box').value;
     const s = new lunr.TinySegmenter();
     const results = idx.search(s.segment(q).join(' '));
     showResults(results);
 });

 
</script>


